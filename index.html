<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TK Pickleball Booking</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: system-ui; background:#0f172a; color:#fff; padding:20px }
    h2 { margin-bottom:10px }
    .card { background:#1e293b; padding:16px; border-radius:12px; margin-bottom:12px }
    .grid { display:grid; grid-template-columns:repeat(2,1fr); gap:8px }
    button { padding:14px; border-radius:10px; border:none; background:#334155; color:#fff; font-size:16px }
    button.active { background:#22c55e; color:#000; font-weight:600 }
    button.confirm { background:#22c55e; color:#000; font-weight:bold; width:100% }
    input { width:100%; padding:12px; border-radius:8px; border:none; font-size:16px }
  </style>
</head>
<body>
<h2>üèì TK Pickleball Court Booking</h2>

<div class="card">
  <label>Name</label>
  <input id="name" placeholder="Your name">
</div>

<div class="card">
  <label>Phone Number</label>
  <input id="phone" placeholder="Your phone number">
</div>

<div class="card">
  <label>Date</label>
  <input type="date" id="date">
</div>

<div class="card">
  <label>Duration</label>
  <div class="grid">
    <button onclick="setDuration(this,1)">1 Hour</button>
    <button onclick="setDuration(this,2)">2 Hours</button>
    <button onclick="setDuration(this,3)">3 Hours</button>
  </div>
</div>

<div class="card">
  <label>Start Time</label>
  <div class="grid" id="timeBtns"></div>
</div>

<div class="card">
  <label>Courts</label>
  <div class="grid">
    <button onclick="setCourts(this,1)">1 Court</button>
    <button onclick="setCourts(this,2)">2 Courts</button>
    <button onclick="setCourts(this,3)">3 Courts</button>
    <button onclick="setCourts(this,4)">4 Courts</button>
  </div>
</div>

<button class="confirm" onclick="confirmBooking()">Confirm ($15/hr ‚Ä¢ Pay on Arrival)</button>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

let duration = null, time = null, courts = null;

const hours = [
  "08:00","09:00","10:00","11:00","12:00","13:00",
  "14:00","15:00","16:00","17:00","18:00",
  "19:00","20:00","21:00"
];

function clear(btns) { btns.forEach(b => b.classList.remove("active")); }

function setDuration(btn, val) {
  duration = val;
  clear([...btn.parentNode.children]);
  btn.classList.add("active");
  renderTimes();
}

function renderTimes() {
  const c = document.getElementById("timeBtns");
  c.innerHTML = "";
  time = null;
  for (let i = 0; i < hours.length - (duration - 1); i++) {
    const b = document.createElement("button");
    b.innerText = hours[i];
    b.onclick = () => {
      clear([...c.children]);
      b.classList.add("active");
      time = hours[i];
    };
    c.appendChild(b);
  }
}

function setCourts(btn, val) {
  courts = val;
  clear([...btn.parentNode.children]);
  btn.classList.add("active");
}

function confirmBooking() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const date = document.getElementById("date").value;
  const telegramUserId = tg?.initDataUnsafe?.user?.id || "";

  if (!name || !phone || !date || !duration || !time || !courts) {
    alert("Please fill all fields");
    return;
  }

  // Replace with your Google Apps Script backend URL
  const backendUrl = 'https://script.google.com/macros/s/AKfycbySlkS8Yb3ACIfh5izbul6FfwTxgzrWg4_SnEMHsC21JyiaC1V9fak4GQFP4w3FvyjYPw/exec';

  fetch(backendUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      date,
      time,
      duration,
      courts,
      name,
      phone,
      telegramUserId
    }),
  })
  .then(response => response.json())
  .then(data => {
    if (data.status === "success") {
      setTimeout(() => tg.close(), 500);
    } else {
      alert(data.message || "Booking failed");
    }
  })
  .catch(error => {
    console.error("Error:", error);
    alert("Booking failed");
  });
}
</script>

</body>
</html>
